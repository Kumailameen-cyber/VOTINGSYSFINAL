@{
    ViewData["Title"] = "Voter Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var user = ViewBag.User as practice.Models.User;
    var activeElections = ViewBag.ActiveElection as List<practice.Models.Election>;
    var votedElectionIds = ViewBag.VotedElectionIds as List<int>;
}

<div class="container mt-5">

    <div class="row mb-5">
        <div class="col-12">
            <div class="card border-0 shadow-sm overflow-hidden" style="border-radius: 16px;">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center flex-wrap">

                        <div class="icon-box bg-green-light text-green rounded-4 me-4">
                            <i class="fas fa-user-circle fa-2x"></i>
                        </div>

                        <div class="flex-grow-1">
                            <h2 class="fw-bold mb-0 text-dark">Welcome, @user?.FullName</h2>
                            <p class="text-muted mb-2">@user?.Email</p>

                            <a asp-action="EditProfile" class="btn btn-sm btn-outline-success rounded-pill px-3 shadow-sm transition-hover">
                                <i class="fas fa-user-edit me-1"></i> Edit Profile
                            </a>
                        </div>

                        <div class="mt-3 mt-md-0">
                            @if (user?.IsVerified == true)
                            {
                                <span class="badge bg-green-subtle text-green rounded-pill px-3 py-2 fs-6">
                                    <i class="fas fa-check-circle me-1"></i> Verified Voter
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-warning-subtle text-warning rounded-pill px-3 py-2 fs-6">
                                    <i class="fas fa-clock me-1"></i> Pending Verification
                                </span>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @if (user?.IsVerified != true)
    {
        <div class="alert alert-warning border-0 shadow-sm d-flex align-items-center mb-5" role="alert" style="border-radius: 12px;">
            <i class="fas fa-exclamation-triangle fa-2x me-3 opacity-50"></i>
            <div>
                <h5 class="alert-heading fw-bold mb-1">Account Under Review</h5>
                <p class="mb-0 small">Your registration is pending administrator approval. You will be able to vote once verified.</p>
            </div>
        </div>
    }

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold text-dark mb-0">Active Elections</h4>
        <span class="badge bg-light text-secondary rounded-pill">@(activeElections?.Count ?? 0) Live</span>
    </div>

    @if (activeElections != null && activeElections.Count > 0)
    {
        <div class="row">
            @foreach (var election in activeElections)
            {
                bool hasVoted = votedElectionIds != null && votedElectionIds.Contains(election.Id);

                <div class="col-lg-12 mb-4">
                    <div class="card border-0 shadow-sm h-100 card-hover" style="border-left: 5px solid #16a34a; border-radius: 12px;">
                        <div class="card-body p-4">

                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h3 class="fw-bold text-dark mb-1">@election.Title</h3>
                                    <span class="badge bg-light text-secondary border">@election.ElectionType</span>
                                </div>
                                @if (hasVoted)
                                {
                                    <div class="text-success text-center">
                                        <i class="fas fa-check-circle fa-2x mb-1"></i>
                                        <div class="small fw-bold">Voted</div>
                                    </div>
                                }
                            </div>

                            <p class="text-muted mb-4">@election.Description</p>

                            <div class="row g-3 mb-4">
                                <div class="col-md-4 col-6">
                                    <div class="d-flex align-items-center">
                                        <div class="icon-box-sm bg-light text-primary rounded-circle me-3">
                                            <i class="fas fa-calendar-alt"></i>
                                        </div>
                                        <div>
                                            <small class="text-muted d-block">Start Date</small>
                                            <span class="fw-bold text-dark">@election.StartDate.ToString("MMM dd, yyyy")</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 col-6">
                                    <div class="d-flex align-items-center">
                                        <div class="icon-box-sm bg-light text-danger rounded-circle me-3">
                                            <i class="fas fa-calendar-times"></i>
                                        </div>
                                        <div>
                                            <small class="text-muted d-block">End Date</small>
                                            <span class="fw-bold text-dark">@election.EndDate.ToString("MMM dd, yyyy")</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="d-grid gap-2">
                                @if (hasVoted)
                                {
                                    <button class="btn btn-secondary disabled py-3" style="opacity: 0.7;">
                                        Vote Submitted
                                    </button>
                                }
                                else
                                {
                                    /* Note: Added forestgreen background directly to the button via CSS class or style */
                                    <a asp-action="Vote" asp-route-electionId="@election.Id" class="btn btn-lg py-3 shadow-success-hover text-white" style="background-color: #16a34a;">
                                        <i class="fas fa-vote-yea me-2"></i>Cast Your Vote
                                    </a>
                                }
                            </div>

                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="text-center py-5">
            <div class="icon-box bg-light text-muted rounded-circle mx-auto mb-3" style="width: 80px; height: 80px;">
                <i class="fas fa-box-open fa-3x"></i>
            </div>
            <h5 class="text-muted">No Active Elections</h5>
            <p class="text-secondary">Please check back later for upcoming polls.</p>
        </div>
    }

</div>

<style>
    /* Green Color Palette */
    .text-green {
        color: #16a34a !important;
    }

    .bg-green-light {
        background-color: rgba(22, 163, 74, 0.1);
    }

    .bg-green-subtle {
        background-color: rgba(22, 163, 74, 0.1);
    }

    /* Warning Palette */
    .text-warning {
        color: #d97706 !important;
    }

    .bg-warning-subtle {
        background-color: rgba(251, 191, 36, 0.1);
    }

    /* Icon Boxes */
    .icon-box {
        width: 64px;
        height: 64px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .icon-box-sm {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Card Hover Effect */
    .card-hover {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.05) !important;
        }

    /* Button Shadow on Hover */
    .shadow-success-hover:hover {
        box-shadow: 0 4px 14px 0 rgba(22, 163, 74, 0.39);
        transform: translateY(-1px);
    }

    /* Transition for Edit Button */
    .transition-hover {
        transition: all 0.2s ease;
    }

        .transition-hover:hover {
            transform: translateY(-2px);
            background-color: #16a34a;
            color: white;
            box-shadow: 0 4px 6px rgba(22, 163, 74, 0.2);
        }

    /* Custom Outline Success Button to match theme */
    .btn-outline-success {
        color: #16a34a;
        border-color: #16a34a;
    }

        .btn-outline-success:hover {
            background-color: #16a34a;
            color: white;
        }
</style>
@{
    ViewData["Title"] = "Candidate Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";

    // Logged-in user details
    var user = ViewBag.User as practice.Models.User;

    // Candidate-specific information
    var candidate = ViewBag.Candidate as practice.Models.Candidate;

    // List of currently active elections
    var activeElections = ViewBag.ActiveElection as List<Election>;

    // Total votes received by the candidate
    var totalVotes = (int)ViewBag.TotalVotes;

    int i;
}

<div class="container mt-4">

    <!-- ================= Candidate Overview Section ================= -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient-info text-white shadow-lg border-0">
                <div class="card-body py-5">
                    <div class="row align-items-center">

                        <!-- Candidate Basic Information -->
                        <div class="col-md-8">
                            <h2 class="mb-2">
                                <i class="fas fa-user-tie me-2"></i>@user?.FullName
                            </h2>

                            <h4 class="mb-2">
                                <i class="fas fa-flag me-2"></i>@candidate?.PartyName
                            </h4>

                            <p class="mb-0">
                                <i class="fas fa-envelope me-2"></i>@user?.Email

                                <!-- Approval status of candidate -->
                                @if (user?.IsVerified == true && candidate?.IsApproved == true)
                                {
                                    <span class="badge bg-success ms-2">
                                        <i class="fas fa-check-circle me-1"></i>Approved
                                    </span>
                                }
                                else
                                {
                                    <span class="badge bg-warning ms-2">
                                        <i class="fas fa-clock me-1"></i>Pending Approval
                                    </span>
                                }
                            </p>
                        </div>

                        <!-- Vote Count Summary -->
                        <div class="col-md-4 text-md-end mt-3 mt-md-0">
                            <div class="bg-white rounded p-3 shadow">
                                <h6 class="text-muted mb-1">Total Votes Received</h6>
                                <h1 class="text-primary mb-0">
                                    <i class="fas fa-vote-yea me-2"></i>@totalVotes
                                </h1>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= Active Elections Section ================= -->
    @if (activeElections != null && candidate?.IsApproved == true)
    {
        i = 1;

        @foreach (var election in activeElections)
        {
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow border-0">

                        <!-- Election Header -->
                        <div class="card-header bg-primary text-white py-3">
                            <h4 class="mb-0">@i: @election.Title</h4>
                        </div>

                        <div class="card-body">
                            <p class="text-muted mb-3">
                                @election.Description
                            </p>

                            <!-- Election Details -->
                            <div class="row mb-3">
                                <div class="col-md-3">
                                    <small class="text-muted">Start Date</small>
                                    <p class="fw-bold">@election.StartDate.ToString("MMM dd, yyyy")</p>
                                </div>

                                <div class="col-md-3">
                                    <small class="text-muted">End Date</small>
                                    <p class="fw-bold">@election.EndDate.ToString("MMM dd, yyyy")</p>
                                </div>

                                <div class="col-md-3">
                                    <small class="text-muted">Election Type</small>
                                    <p class="fw-bold">@election.ElectionType</p>
                                </div>

                                <div class="col-md-3">
                                    <small class="text-muted">Status</small>
                                    <p class="fw-bold">
                                        <span class="badge bg-success">
                                            <i class="fas fa-check-circle me-1"></i>Active
                                        </span>
                                    </p>
                                </div>
                            </div>

                            <!-- Participate Button: submits election ID -->
                            <div class="text-center mt-3">
                                <form asp-action="Participate" asp-controller="Candidate" method="post">
                                    <input type="hidden" name="electionId" value="@election.Id" />

                                    <button type="submit" class="btn btn-success btn-lg px-5">
                                        <i class="fas fa-user-plus me-2"></i>Participate in Election
                                    </button>
                                </form>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            i++;
        }
    }

    <!-- ================= Candidate Profile Summary ================= -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card shadow border-0 h-100">

                <div class="card-header bg-light py-3">
                    <h5 class="mb-0">
                        <i class="fas fa-id-card me-2"></i>Candidate Profile
                    </h5>
                </div>

                <div class="card-body">

                    <!-- Party Information -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <p class="mb-2">
                                <strong><i class="fas fa-flag me-2 text-primary"></i>Party Name:</strong><br />
                                @candidate?.PartyName
                            </p>
                        </div>

                        <div class="col-md-6">
                            <p class="mb-2">
                                <strong><i class="fas fa-tag me-2 text-primary"></i>Party Symbol:</strong><br />
                                @candidate?.PartySymbol
                            </p>
                        </div>
                    </div>

                    <!-- Manifesto -->
                    <div class="mb-3">
                        <p class="mb-2">
                            <strong><i class="fas fa-scroll me-2 text-primary"></i>Manifesto:</strong>
                        </p>
                        <p class="text-muted">@candidate?.Manifesto</p>
                    </div>

                    <!-- Biography (if available) -->
                    @if (!string.IsNullOrEmpty(candidate?.Biography))
                    {
                        <div class="mb-3">
                            <p class="mb-2">
                                <strong><i class="fas fa-user me-2 text-primary"></i>Biography:</strong>
                            </p>
                            <p class="text-muted">@candidate?.Biography</p>
                        </div>
                    }

                    <!-- Education & Experience -->
                    <div class="row">
                        @if (!string.IsNullOrEmpty(candidate?.Education))
                        {
                            <div class="col-md-6 mb-2">
                                <p class="mb-1">
                                    <strong><i class="fas fa-graduation-cap me-2 text-primary"></i>Education:</strong>
                                </p>
                                <p class="text-muted">@candidate?.Education</p>
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(candidate?.PreviousExperience))
                        {
                            <div class="col-md-6 mb-2">
                                <p class="mb-1">
                                    <strong><i class="fas fa-briefcase me-2 text-primary"></i>Previous Experience:</strong>
                                </p>
                                <p class="text-muted">@candidate?.PreviousExperience</p>
                            </div>
                        }
                    </div>

                    <!-- Edit Profile Button -->
                    <div class="text-center mt-3">
                        <a asp-action="EditProfile" class="btn btn-primary">
                            <i class="fas fa-edit me-2"></i>Edit Profile
                        </a>
                    </div>

                </div>
            </div>
        </div>

        <!-- ================= Account Information ================= -->
        <div class="card shadow border-0">
            <div class="card-body text-center py-4">
                <i class="fas fa-info-circle fa-4x text-info mb-3"></i>
                <h5 class="card-title">Account Information</h5>
                <p class="mb-1 small"><strong>Voter ID:</strong> @user?.VoterIdNumber</p>
                <p class="mb-1 small"><strong>Phone Number:</strong> @user?.PhoneNumber</p>
                <p class="mb-0 small">
                    <strong>Registration Date:</strong><br />
                    @candidate?.RegisteredAt.ToString("MMM dd, yyyy")
                </p>
            </div>
        </div>

    </div>
</div>

<style>
    /* Gradient background for candidate overview card */
    .bg-gradient-info {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
</style>
